# How to contribute to `sdm-pkg-plurality-tutorials`

This is an overview of the contributing workflow. If you want to add your contribution, please read this document carefully and follow our recommendations.

## Open a pull request

Contributions are accepted when submitted with a pull request (PR). We ask you to **fork** this repository, and then create a new branch for your contribution. When you open the PR, please write a comment that details which packages must be installed, including their version (see [Project library](#project-library)).

## Project library

This project uses `renv` to track package versions and create a project library. After you have cloned the repo, to recreate the project library, run `renv::restore()`. The command takes some time to run, but it will isolate the packages used in this project from those that you already have installed in your system/user library, avoiding possible conflicts.

When you install a new package for your contribution, it is important that you specify the version. There are two cases:

1. The package is available on CRAN. For example, to install `SDMtune` version `1.0.0` use `renv::install("SDMtune@1.0.0")`.
2. The package is available on GitHub. In this case, you must provide the commit SHA. This is very important because GitHub versions change constantly over time, and this way we can freeze the version used to compile the vignettes. For example, for `modleR` we used `renv::install("Model-R/modleR@c2bebe5853db3687805c80f691d1fde7d722fce9")`.

> [!IMPORTANT]
It is very important that you don't run `renv::snapshot()` to save the installed package in the `renv.lock` file yourself. This is to avoid annoying merge conflicts that are difficult to solve. Instead, please provide instructions to the maintainer in the PR comment, including the full command, like in the examples above.

For example you could write:

```md
Please, install `SDMtune` with `renv::install("SDMtune@1.0.0")`
```

This is to ensure that the version available in the project is the same as the one used in your contribution.

## Relevant parts to edit

In addition to the R code, there are two important parts to edit when you add your contribution.

### The list of authors in the `yaml` parameters.

Names after the first author are in alphabetical order, e.g.:

```yaml
author:
  - Adam B. Smith
  - Olivier Broennimann
  - Gonzalo E. Pinilla-Buitrago
  - Sylvain Schmitt
  - Sergio Vignali
```

### The list of packages at the beginning of the vignette

Here you have to provide a short description. Below are two examples, one from CRAN and the other from GitHub:

```md
* `sampbias` v-`r packageVersion("sampbias")` ([GitHub](https://github.com/azizka/sampbias/tree/b1d951bf05159f396573d5077d12e79adc3f0c3a)): for correcting for sampling bias among occurrences [@pkg-sampbias; @sampbias2021]
* `wallace` v-`r packageVersion("wallace")` (CRAN): a graphical user interface to obtain SDM/ENMs [@pkg-wallace; @wallace2018; @wallace2023]
```

For CRAN, just change the name of the package and the description, while for GitHub you must also add the SHA number and provide the correct URL.

> [!IMPORTANT]
Delete the citations and leave the square brackets. The citations are auto-generated by a script and the mantainer will update this part for you to avoid annoying merge conflicts.

## Coding conventions

Have a look at the code already present in our vignettes to understand the style we use. Below is a good example:

````r
```{r esm-modeling, results='hide'}
# Construct many "small" models
esms <- ecospat::ecospat.ESM.Modeling(data = biomod_data,
                                      models = "GLM",
                                      NbRunEval = 10,
                                      DataSplit = 70,
                                      # better, but takes longer if TRUE!
                                      tune = FALSE,
                                      weighting.score = "TSS",
                                      # site-level weights for de-biasing
                                      Yweights = occ_bg_weights,
                                      # if you have problems set this to FALSE
                                      parallel = TRUE)
```
````

Important parts are:

* Each line of code and comments should not exceed 80 characters. To visualise the margin limits in RStudio, go to the menu and click on *Tools*, then on *Global Options...*. Next, click on the tab *Code*, then on the subtab *Display*, then select *Show margin* and set the *Margin column* to 80. Finally, click on *OK* and a line will appear on the left side showing the distance of 80 characters.

* The label of the code chunk is lowercase and uses a dash `-` as a separator.

* Chunk parameters are defined without a space around `=`, use a single quote `'` instead of a double one `"`, and are separated by a comma `,`.

* Comments with a single sentence never end with a full period. Add the full period only if you have more than one sentence.

* Object names are lowercase and words are separated by an underscore `_`. For example, `envs_terra` is fine, but `envsTerra` or `envs.terra` are not.

* The function is prefixed by the package: e.g. `ecospat::ecospat.ESM.Modeling()`. Only `ggplot2` functions are not.

* Each function argument is provided with its name and should be in its own line.

* The `=` between the function argument and value is surrounded by a space character ` `.

* Strings are always surrounded by double quotes `"` and not single ones `'`.

* Never shorten logical values: always `TRUE` or `FALSE` and never `T` or `F`.

If the value assigned to one of the function arguments contains too many characters and exceeds the limit of 80, you have two options:

1. Split it into multiple lines, as done for the argument `metric.eval` in the example below:

   ```r
    bm_mod <- biomod2::BIOMOD_Modeling(bm.format = bm_format,
                                       modeling.id = "Split70",
                                       models = c("RF", "GLM"),
                                       CV.strategy = "random",
                                       CV.nb.rep = 3,
                                       CV.perc = 0.7,
                                       bm.options = bm_opt,
                                       metric.eval = c("ACCURACY", "KAPPA",
                                                       "TSS", "ROC"),
                                       var.import = 1,
                                       seed.val = 123,
                                       do.progress = FALSE)
    ```

2. Assign it to an object and then use this object instead, as done for the argument `em.algo` in the example below:

    ```r
    em_algo <- c("EMmean", "EMca", "EMcv")
    bm_ens <- biomod2::BIOMOD_EnsembleModeling(bm.mod = bm_mod,
                                               models.chosen = "all",
                                               em.by = "all",
                                               em.algo = em_algo,
                                               metric.select = "TSS",
                                               metric.select.thresh = 0.4,
                                               var.import = 1,
                                               seed.val = 123,
                                               do.progress = FALSE)
    ```

Finally, if the name of the function or the object is very long and there is not enough space to stay within the 80-character limit, use the same format as the example below. This should be the last choice and can be used only when the previous ones do not work.

```r
bm_ens_proj_cur <- biomod2::BIOMOD_EnsembleForecasting(
  bm.em = bm_ens,
  bm.proj = bm_mod_proj_cur,
  proj.name = proj_name,
  models.chosen = "all",
  metric.binary = "TSS"
)
```

## Text conventions

There are only two conventions for the text.

To create a new paragraph use a backslash `\` and not a blank line. This is because with the second method, a blank line is created and the output will look different from the other parts of the vignettes:

Good example:

```md
Lorem ipsum dolor sit amet, imperdiet imperdiet sollicitudin iaculis vitae pharetra platea.\
Lacus amet duis in justo. Sem faucibus, vitae amet a vehicula, dis eget amet.
```

Bad example:

```
Lorem ipsum dolor sit amet, imperdiet imperdiet sollicitudin iaculis vitae pharetra platea.

Lacus amet duis in justo. Sem faucibus, vitae amet a vehicula, dis eget amet.
```

If you have installed a new package and add a citation in the text, please add only the square brackets `[]` without the citation key/s. This will be done later by the maintainer!

## References

Besides the citations for packages, which will be created by the maintainer, you may need to add other citations. Before adding a new citation, please check whether it already exists in the `vignettes/references.bib`. If it is not there, add a new entry to the file `vignettes/references.bib`. Be sure to have all the fields listed below, if available:

```
@Article{phillips2017,
  title = {Opening the black box: An open-source release of {Maxent}},
  author = {Phillips, Steven J. and Anderson, Robert P. and DudÃ­k, Miroslav and
    Schapire, Robert E. and Blair, Mary E.},
  journal = {Ecography},
  volume = {40},
  pages = {887-893},
  number = {7},
  year = {2017},
  doi = {10.1111/ecog.03049}
}
```
To create the BibTeX citation, you can search for the article in Google Scholar and click on `Cite` and then `BibTeX`. Copy everything and paste it at the bottom of `vignettes/references.bib`. After pasting the text, you need to make some changes:

1. Change the citation type and capitalize it. For example `@Article` and not `@article`.

2. The proposed citation key is usually too long. It is usually sufficient to use the `firstautoryear` format, but you should check whether it is already used in other citations.

3. If the `title` and/or `author` fields exceed 80 characters, break them into two lines and indent with two spaces.

4. If there are capitalized words in the `title`, you have to enclose them in curly brackets, otherwise they will be converted to lowercase. For reference, see `{Maxent}` in the example above.

5. If the `title` contains a species name that should be in italics, use the following format: `{\emph{Gypaetus barbatus}}`.

6. The names in the `name` field are provided as `family-name, given-names` and multiple authors are separated by `and`.

7. Google Scholar does not provide the DOI, but usually does include the `publisher` field. Please delete this field and create one for `doi`. Be sure to include only the number without ` https://doi.org/`.

If you create the BibTeX entry using another method, please be sure to include only the relevant fields described above.
